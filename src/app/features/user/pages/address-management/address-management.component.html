<!--
  地址管理頁面
  Address Management Page

  教學重點: Material Cards, 地址 CRUD 操作, Dialog
-->

<div class="address-management-page">
  <!-- 頁面標題 -->
  <div class="page-header">
    <button mat-icon-button (click)="goBack()" class="back-btn">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1 class="page-title">{{ 'address.title' | translate }}</h1>
    <button mat-raised-button color="primary" (click)="openAddAddressDialog()">
      <mat-icon>add</mat-icon>
      {{ 'address.add_new' | translate }}
    </button>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <mat-spinner diameter="60"></mat-spinner>
      <p>{{ 'common.loading' | translate }}</p>
    </div>
  }

  <!-- Empty State -->
  @else if (addresses().length === 0) {
    <div class="empty-state">
      <mat-icon class="empty-icon">location_off</mat-icon>
      <h2>{{ 'address.empty' | translate }}</h2>
      <p>{{ 'address.empty_description' | translate }}</p>
      <button mat-raised-button color="primary" (click)="openAddAddressDialog()">
        <mat-icon>add</mat-icon>
        {{ 'address.add_first' | translate }}
      </button>
    </div>
  }

  <!-- Address List -->
  @else {
    <div class="address-list">
      @for (address of addresses(); track address.id) {
        <mat-card class="address-card" [class.default]="address.isDefault">
          <!-- 預設地址標籤 -->
          @if (address.isDefault) {
            <mat-chip class="default-chip">
              <mat-icon>check_circle</mat-icon>
              {{ 'address.default' | translate }}
            </mat-chip>
          }

          <mat-card-header>
            <mat-icon mat-card-avatar>{{ address.label === 'home' ? 'home' : address.label === 'office' ? 'business' : 'place' }}</mat-icon>
            <mat-card-title>{{ AddressFormatter.getLabelDisplayName(address) }}</mat-card-title>
            <mat-card-subtitle>{{ address.recipientName }}</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <div class="address-details">
              <div class="detail-row">
                <mat-icon>person</mat-icon>
                <span>{{ address.recipientName }}</span>
              </div>
              <div class="detail-row">
                <mat-icon>phone</mat-icon>
                <span>{{ address.recipientPhone }}</span>
              </div>
              <div class="detail-row">
                <mat-icon>location_on</mat-icon>
                <span>{{ AddressFormatter.formatFullAddress(address) }}</span>
              </div>
            </div>
          </mat-card-content>

          <mat-divider></mat-divider>

          <mat-card-actions>
            @if (!address.isDefault) {
              <button mat-button (click)="setAsDefault(address)">
                <mat-icon>check_circle_outline</mat-icon>
                {{ 'address.set_as_default' | translate }}
              </button>
            }
            <button mat-button (click)="openEditAddressDialog(address)">
              <mat-icon>edit</mat-icon>
              {{ 'common.edit' | translate }}
            </button>
            @if (!address.isDefault) {
              <button mat-button color="warn" (click)="deleteAddress(address)">
                <mat-icon>delete</mat-icon>
                {{ 'common.delete' | translate }}
              </button>
            }
          </mat-card-actions>
        </mat-card>
      }
    </div>
  }
</div>
